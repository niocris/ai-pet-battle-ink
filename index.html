<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pet Mint - Ink Blockchain</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e1b4b 0%, #4c1d95 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .title-section h1 {
            font-size: 2em;
            background: linear-gradient(135deg, #a78bfa 0%, #ec4899 50%, #f472b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .ink-badge {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .wallet-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
        }

        .wallet-btn.connected {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .wallet-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .wallet-address {
            font-size: 0.85em;
            color: #666;
            background: #f5f7fa;
            padding: 5px 12px;
            border-radius: 15px;
        }

        .balance {
            font-size: 0.85em;
            color: #27ae60;
            background: #e8f8f5;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 20px 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            min-width: 140px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-content {
            text-align: center;
            margin: 40px 0;
        }

        .pet-display {
            margin: 30px auto;
            max-width: 300px;
        }

        .pet-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .pet-image-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            background: #2d1b4e;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .pet-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .pet-emoji {
            font-size: 6em;
        }

        .pet-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }

        .pet-type {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px 0;
        }

        .type-rock { background: #b8860b; color: white; }
        .type-fly { background: #87ceeb; color: white; }
        .type-electric { background: #ffd700; color: #333; }
        .type-fire { background: #ff6b6b; color: white; }
        .type-water { background: #4ecdc4; color: white; }
        .type-grass { background: #95e1d3; color: white; }

        .rarity-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 5px;
        }

        .rarity-common { background: #95a5a6; color: white; }
        .rarity-rare { background: #3498db; color: white; }
        .rarity-unique { background: #9b59b6; color: white; }
        .rarity-legendary { 
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 15px rgba(243, 156, 18, 0.5); }
            50% { box-shadow: 0 0 25px rgba(243, 156, 18, 0.8); }
        }

        .special-creature {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 45px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 15px;
            font-weight: bold;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-gm {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn-gm:hover:not(:disabled) {
            box-shadow: 0 15px 30px rgba(243, 156, 18, 0.4);
        }

        .price-tag {
            font-size: 1.1em;
            color: #27ae60;
            font-weight: bold;
            margin-top: 10px;
        }

        .daily-quest {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe5b4 100%);
            border-left: 5px solid #f39c12;
            padding: 25px;
            margin: 30px 0;
            border-radius: 15px;
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quest-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        .quest-reward {
            color: #27ae60;
            font-weight: bold;
            font-size: 1.1em;
        }

        .quest-desc {
            color: #666;
            margin: 10px 0;
        }

        .quest-timer {
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 60px;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.3em;
            color: #667eea;
        }

        .tx-info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            word-break: break-all;
        }

        .tx-link {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }

        .tx-link:hover {
            text-decoration: underline;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .info-box h3 {
            color: #2980b9;
            margin-bottom: 10px;
        }

        .empty-state {
            padding: 60px 20px;
            text-align: center;
        }

        .empty-icon {
            font-size: 5em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
        }

        .countdown {
            font-size: 1.5em;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <svg width="80" height="80" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" class="logo-img">
                    <defs>
                        <linearGradient id="logoBgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1e1b4b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#4c1d95;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="logoRingGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f472b6;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect width="400" height="400" fill="url(#logoBgGradient)" rx="200"/>
                    <circle cx="200" cy="200" r="150" fill="none" stroke="url(#logoRingGradient)" stroke-width="16"/>
                    <circle cx="200" cy="200" r="125" fill="none" stroke="#2d1b4e" stroke-width="20"/>
                    <!-- Pixel monster -->
                    <g transform="translate(100, 100)">
                        <rect x="20" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="40" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="60" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="80" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="100" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="120" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="0" y="40" width="20" height="20" fill="#ffffff"/>
                        <rect x="20" y="40" width="20" height="20" fill="#ffffff"/>
                        <rect x="40" y="40" width="20" height="20" fill="#ffffff"/>
                        <rect x="20" y="20" width="20" height="20" fill="#ffffff"/>
                        <rect x="40" y="20" width="20" height="20" fill="#ffffff"/>
                        <rect x="20" y="0" width="20" height="20" fill="#ffffff"/>
                        <rect x="40" y="0" width="20" height="20" fill="#ffffff"/>
                        <rect x="140" y="40" width="20" height="20" fill="#ffffff"/>
                        <rect x="160" y="20" width="20" height="20" fill="#ffffff"/>
                        <rect x="160" y="60" width="20" height="20" fill="#ffffff"/>
                        <rect x="180" y="10" width="20" height="20" fill="#ffffff"/>
                        <rect x="180" y="70" width="20" height="20" fill="#ffffff"/>
                        <rect x="40" y="80" width="20" height="20" fill="#ffffff"/>
                        <rect x="40" y="100" width="20" height="20" fill="#ffffff"/>
                        <rect x="80" y="80" width="20" height="20" fill="#ffffff"/>
                        <rect x="80" y="100" width="20" height="20" fill="#ffffff"/>
                    </g>
                </svg>
                <div class="title-section">
                    <h1>AI Pet Arena</h1>
                    <span class="ink-badge">‚õìÔ∏è Ink Blockchain</span>
                </div>
            </div>
            <div class="wallet-section">
                <button id="walletBtn" class="wallet-btn" onclick="toggleWallet()">
                    üîå Connect Wallet
                </button>
                <div class="wallet-info" id="walletInfo" style="display: none;">
                    <span id="walletAddress" class="wallet-address"></span>
                    <span id="balance" class="balance"></span>
                </div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-label">üé® Pets Minted</div>
                <div class="stat-value" id="mintCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">‚òÄÔ∏è GM Streaks</div>
                <div class="stat-value" id="gmCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">üí∞ Total Spent</div>
                <div class="stat-value" id="totalSpent">0</div>
            </div>
        </div>

        <div id="mainContent" class="main-content">
            <div id="emptyState" class="empty-state">
                <div class="empty-icon">üéÆ</div>
                <div class="empty-text">Mint your first AI-generated pet!</div>
                <button class="btn" onclick="mintPet()">
                    üé≤ Mint Pet
                    <div class="price-tag">0.00001 ETH</div>
                </button>
            </div>

            <div id="petDisplay" class="pet-display" style="display: none;">
                <div class="pet-card">
                    <div class="pet-image-container" id="petImageContainer">
                        <div class="pet-emoji">üéÆ</div>
                    </div>
                    <div class="pet-name" id="petName">Your Pet</div>
                    <div id="petType" class="pet-type">Rock</div>
                </div>
                <button class="btn" onclick="mintPet()">
                    üîÑ Mint New Pet
                    <div class="price-tag">0.00001 ETH</div>
                </button>
            </div>

            <div id="loadingState" class="loading" style="display: none;">
                <div class="spinner"></div>
                <div class="loading-text" id="loadingText">Generating your AI pet...</div>
            </div>

            <div id="txInfo" style="display: none;"></div>
        </div>

        <div class="daily-quest">
            <div class="quest-header">
                <div class="quest-title">‚òÄÔ∏è Daily GM Quest</div>
                <div class="quest-reward">+0.000005 ETH</div>
            </div>
            <div class="quest-desc">
                Say GM to the community every day! Complete this quest to earn rewards.
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="gmButton" class="btn btn-gm" onclick="doGM()">
                    ‚òÄÔ∏è GM!
                </button>
            </div>
            <div class="quest-timer" id="questTimer">
                Next GM available in: <span id="countdown">00:00:00</span>
            </div>
        </div>

        <div class="info-box">
            <h3>üé® How It Works</h3>
            <p><strong>1.</strong> Connect your Ink wallet</p>
            <p><strong>2.</strong> Mint AI-generated pets for 0.00001 ETH each</p>
            <p><strong>3.</strong> Say GM daily to earn 0.000005 ETH</p>
            <p><strong>4.</strong> Collect unique pets and build your streak!</p>
        </div>

        <div class="info-box">
            <h3>üåê About Ink Blockchain</h3>
            <p>Ink is an Ethereum Layer 2 optimized for consumer apps. Ultra-low fees make it perfect for NFT minting and daily interactions!</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script>
        let walletConnected = false;
        let userAddress = null;
        let provider = null;
        let signer = null;
        let currentPet = null;
        
        let mintCount = 0;
        let gmCount = 0;
        let totalSpent = 0;
        let lastGMTime = 0;

        const MINT_PRICE = "0.00001";
        const GM_REWARD = "0.000005";
        const GM_COOLDOWN = 24 * 60 * 60 * 1000; // 24 hours
        const HF_API_KEY = "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";
        const HF_MODEL = "CompVis/stable-diffusion-v1-4";
        
        const INK_TESTNET = {
            chainId: '0xBAAC2',
            chainName: 'Ink Sepolia Testnet',
            nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
            rpcUrls: ['https://rpc-gel-sepolia.inkonchain.com'],
            blockExplorerUrls: ['https://explorer-sepolia.inkonchain.com']
        };

        const petTypes = ['rock', 'fly', 'electric', 'fire', 'water', 'grass'];
        
        const petEmojis = {
            rock: ['üóø', 'ü™®', '‚õ∞Ô∏è'],
            fly: ['ü¶Ö', 'ü¶ã', 'üïäÔ∏è'],
            electric: ['‚ö°', 'üîå', '‚≠ê'],
            fire: ['üî•', 'üåã', '‚òÑÔ∏è'],
            water: ['üíß', 'üåä', '‚ùÑÔ∏è'],
            grass: ['üåø', 'üå±', 'üçÉ']
        };

        const petDescriptions = {
            rock: 'ancient stone guardian with boulder armor',
            fly: 'mystical sky creature with ethereal wings',
            electric: 'lightning beast crackling with electric energy',
            fire: 'blazing inferno demon wreathed in flames',
            water: 'crystalline ice serpent with flowing water',
            grass: 'forest nature spirit covered in vines and leaves'
        };

        // Load saved data
        function loadData() {
            mintCount = parseInt(localStorage.getItem('mintCount') || '0');
            gmCount = parseInt(localStorage.getItem('gmCount') || '0');
            totalSpent = parseFloat(localStorage.getItem('totalSpent') || '0');
            lastGMTime = parseInt(localStorage.getItem('lastGMTime') || '0');
            
            const savedPet = localStorage.getItem('currentPet');
            if (savedPet) {
                currentPet = JSON.parse(savedPet);
                showPet();
            }
            
            updateStats();
            updateGMButton();
        }

        function saveData() {
            localStorage.setItem('mintCount', mintCount);
            localStorage.setItem('gmCount', gmCount);
            localStorage.setItem('totalSpent', totalSpent);
            localStorage.setItem('lastGMTime', lastGMTime);
            if (currentPet) {
                localStorage.setItem('currentPet', JSON.stringify(currentPet));
            }
        }

        function updateStats() {
            document.getElementById('mintCount').textContent = mintCount;
            document.getElementById('gmCount').textContent = gmCount;
            document.getElementById('totalSpent').textContent = totalSpent.toFixed(5);
        }

        async function toggleWallet() {
            if (walletConnected) {
                disconnectWallet();
            } else {
                await connectWallet();
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('Please install MetaMask to connect your wallet!');
                return;
            }

            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                userAddress = accounts[0];

                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: INK_TESTNET.chainId }],
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [INK_TESTNET],
                        });
                    }
                }

                signer = await provider.getSigner();
                walletConnected = true;

                document.getElementById('walletBtn').textContent = '‚úÖ Connected';
                document.getElementById('walletBtn').classList.add('connected');
                document.getElementById('walletAddress').textContent = 
                    `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
                
                const balance = await provider.getBalance(userAddress);
                document.getElementById('balance').textContent = 
                    `üí∞ ${parseFloat(ethers.formatEther(balance)).toFixed(4)} ETH`;
                
                document.getElementById('walletInfo').style.display = 'flex';

            } catch (error) {
                console.error('Connection error:', error);
                alert('Failed to connect wallet: ' + error.message);
            }
        }

        function disconnectWallet() {
            walletConnected = false;
            userAddress = null;
            provider = null;
            signer = null;

            document.getElementById('walletBtn').textContent = 'üîå Connect Wallet';
            document.getElementById('walletBtn').classList.remove('connected');
            document.getElementById('walletInfo').style.display = 'none';
        }

        async function mintPet() {
            if (!walletConnected) {
                alert('Please connect your wallet first!');
                await connectWallet();
                return;
            }

            const confirmed = confirm(
                `Mint a new AI-generated pet?\n\n` +
                `Cost: ${MINT_PRICE} ETH\n` +
                `Network: Ink Sepolia Testnet`
            );
            
            if (!confirmed) return;

            showLoading('Processing transaction...');

            try {
                const tx = await signer.sendTransaction({
                    to: userAddress,
                    value: ethers.parseEther(MINT_PRICE)
                });

                showLoading('Transaction sent! Generating your pet...');
                await tx.wait();

                mintCount++;
                totalSpent += parseFloat(MINT_PRICE);
                saveData();
                updateStats();

                showTxInfo(tx.hash, 'Pet Minted');
                
                showLoading('AI is creating your unique pet...');
                await generatePet();
                
            } catch (error) {
                console.error('Mint error:', error);
                alert('Transaction failed: ' + error.message);
                hideLoading();
            }
        }

        function getRarity() {
            const rand = Math.random() * 100;
            let cumulative = 0;
            
            for (const [rarity, data] of Object.entries(rarities)) {
                cumulative += data.weight;
                if (rand <= cumulative) {
                    return rarity;
                }
            }
            return 'common';
        }

        function canBeSpecialCreature(type, rarity) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –æ—Å–æ–±–æ–µ —Å—É—â–µ—Å—Ç–≤–æ
            for (const [creature, data] of Object.entries(specialCreatures)) {
                if (data.types.includes(type)) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ä–µ–¥–∫–æ—Å—Ç—å
                    const rarityOrder = ['common', 'rare', 'unique', 'legendary'];
                    const currentRarityIndex = rarityOrder.indexOf(rarity);
                    const minRarityIndex = rarityOrder.indexOf(data.minRarity);
                    
                    if (currentRarityIndex >= minRarityIndex) {
                        // 30% —à–∞–Ω—Å —Å—Ç–∞—Ç—å –æ—Å–æ–±—ã–º —Å—É—â–µ—Å—Ç–≤–æ–º –ø—Ä–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ä–µ–¥–∫–æ—Å—Ç–∏
                        if (Math.random() < 0.3) {
                            return creature;
                        }
                    }
                }
            }
            return null;
        }

        async function generatePet() {
            const type = petTypes[Math.floor(Math.random() * petTypes.length)];
            const rarity = getRarity();
            const specialCreature = canBeSpecialCreature(type, rarity);
            
            console.log(`üé≤ Rolled: ${type} - ${rarity}${specialCreature ? ` - ${specialCreature}!` : ''}`);

            // Determine description
            let description = petDescriptions[type][rarity];
            if (specialCreature) {
                description = specialCreatures[specialCreature].description;
            }
            
            // Generate name with Claude AI
            let petName = '';
            try {
                const namePrompt = specialCreature 
                    ? `Generate a creative fantasy name for a ${rarity} ${specialCreature}. It's a ${type}-type creature described as: "${description}". Respond with ONLY the name, maximum 2 words.`
                    : `Generate a creative fantasy name for a ${rarity} ${type}-type creature. It's described as: "${description}". Respond with ONLY the name, maximum 2 words.`;

                const nameResponse = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [{
                            role: "user",
                            content: namePrompt
                        }]
                    })
                });

                const nameData = await nameResponse.json();
                petName = nameData.content[0].text.trim();
            } catch (error) {
                console.error('AI name generation failed:', error);
                const fallbackNames = {
                    common: ['Tiny', 'Small', 'Young'],
                    rare: ['Mighty', 'Swift', 'Brave'],
                    unique: ['Ancient', 'Mystic', 'Elder'],
                    legendary: ['Supreme', 'Divine', 'Eternal']
                };
                const prefix = fallbackNames[rarity][Math.floor(Math.random() * 3)];
                petName = `${prefix} ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            }

            // Generate pixel art image with Hugging Face
            let imageUrl = null;
            try {
                showLoading('Generating pixel art with AI...');
                
                const creatureType = specialCreature || type;
                const prompt = `pixel art ${rarity} ${creatureType} monster, ${description}, 64x64 sprite, retro game style, detailed, vibrant colors`;
                
                console.log('üé® Generating image with prompt:', prompt);

                const imageResponse = await fetch(
                    `https://api-inference.huggingface.co/models/${HF_MODEL}`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${HF_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            inputs: prompt,
                            options: {
                                wait_for_model: true
                            }
                        })
                    }
                );

                if (imageResponse.ok) {
                    const imageBlob = await imageResponse.blob();
                    imageUrl = URL.createObjectURL(imageBlob);
                    console.log('‚úÖ AI image generated successfully!');
                } else {
                    console.log('‚ö†Ô∏è AI image generation failed, using fallback emoji');
                    imageUrl = null;
                }
            } catch (error) {
                console.error('Hugging Face API error:', error);
                imageUrl = null;
            }

            currentPet = {
                name: petName,
                type: type,
                rarity: rarity,
                specialCreature: specialCreature,
                emoji: petEmojis[type][Math.floor(Math.random() * petEmojis[type].length)],
                imageUrl: imageUrl
            };

            // Show achievement for rare drops
            if (rarity === 'legendary') {
                setTimeout(() => {
                    alert(`üéâ LEGENDARY DROP! üéâ\n\nYou got a ${petName}!\nRarity: ${rarity.toUpperCase()}`);
                }, 500);
            } else if (rarity === 'unique') {
                setTimeout(() => {
                    alert(`‚ú® UNIQUE DROP! ‚ú®\n\nYou got a ${petName}!`);
                }, 500);
            }

            saveData();
            showPet();
            hideLoading();
        }

        function showPet() {
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('petDisplay').style.display = 'block';
            
            // Show AI-generated image or fallback to emoji
            const imageContainer = document.getElementById('petImageContainer');
            
            if (currentPet.imageUrl) {
                imageContainer.innerHTML = 
                    `<img src="${currentPet.imageUrl}" alt="${currentPet.name}" style="width: 100%; height: 100%; object-fit: contain;">`;
            } else {
                imageContainer.innerHTML = 
                    `<div class="pet-emoji">${currentPet.emoji}</div>`;
            }

            // Add special creature badge
            if (currentPet.specialCreature) {
                const badge = document.createElement('div');
                badge.className = 'special-creature';
                badge.textContent = currentPet.specialCreature.toUpperCase();
                imageContainer.appendChild(badge);
            }
            
            document.getElementById('petName').textContent = currentPet.name;
            document.getElementById('petType').className = `pet-type type-${currentPet.type}`;
            document.getElementById('petType').textContent = currentPet.type.toUpperCase();

            // Add rarity badge
            const rarityBadge = document.createElement('span');
            rarityBadge.className = `rarity-badge rarity-${currentPet.rarity}`;
            rarityBadge.textContent = `${rarities[currentPet.rarity].emoji} ${currentPet.rarity.toUpperCase()}`;
            
            const petCard = document.querySelector('.pet-card');
            const nameElement = document.getElementById('petName');
            nameElement.parentElement.insertBefore(rarityBadge, nameElement.nextSibling);
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('petDisplay').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loadingState').style.display = 'none';
        }

        function showTxInfo(hash, action) {
            const txInfo = document.getElementById('txInfo');
            txInfo.innerHTML = `
                <div class="tx-info">
                    ‚úÖ <strong>${action} Successfully!</strong><br>
                    TX: <a href="https://explorer-sepolia.inkonchain.com/tx/${hash}" target="_blank" class="tx-link">
                        ${hash.substring(0, 10)}...${hash.substring(56)}
                    </a>
                </div>
            `;
            txInfo.style.display = 'block';
        }

        async function doGM() {
            if (!walletConnected) {
                alert('Please connect your wallet first!');
                await connectWallet();
                return;
            }

            const now = Date.now();
            if (now - lastGMTime < GM_COOLDOWN) {
                alert('You can only say GM once every 24 hours!');
                return;
            }

            const confirmed = confirm(
                `Say GM to the community?\n\n` +
                `You'll receive: ${GM_REWARD} ETH\n` +
                `Network: Ink Sepolia Testnet`
            );
            
            if (!confirmed) return;

            showLoading('Sending GM transaction...');

            try {
                const tx = await signer.sendTransaction({
                    to: userAddress,
                    value: ethers.parseEther(GM_REWARD)
                });

                await tx.wait();

                gmCount++;
                lastGMTime = now;
                saveData();
                updateStats();
                updateGMButton();

                showTxInfo(tx.hash, 'GM Sent');
                hideLoading();
                
                alert('‚òÄÔ∏è GM! Your daily quest is complete!');
                
            } catch (error) {
                console.error('GM error:', error);
                alert('Transaction failed: ' + error.message);
                hideLoading();
            }
        }

        function updateGMButton() {
            const now = Date.now();
            const timeSinceLastGM = now - lastGMTime;
            
            if (timeSinceLastGM >= GM_COOLDOWN) {
                document.getElementById('gmButton').disabled = false;
                document.getElementById('countdown').textContent = 'Available Now!';
                document.getElementById('countdown').style.color = '#27ae60';
            } else {
                document.getElementById('gmButton').disabled = true;
                startCountdown();
            }
        }

        function startCountdown() {
            setInterval(() => {
                const now = Date.now();
                const timeLeft = GM_COOLDOWN - (now - lastGMTime);
                
                if (timeLeft <= 0) {
                    document.getElementById('countdown').textContent = 'Available Now!';
                    document.getElementById('countdown').style.color = '#27ae60';
                    document.getElementById('gmButton').disabled = false;
                    return;
                }
                
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                document.getElementById('countdown').style.color = '#e74c3c';
            }, 1000);
        }

        window.addEventListener('load', () => {
            loadData();
        });

        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    disconnectWallet();
                } else {
                    window.location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                window.location.reload();
            });
        }
    </script>
</body>
</html>
