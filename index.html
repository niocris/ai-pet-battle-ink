<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pet Battle Arena - Ink Blockchain</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .wallet-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
        }

        .wallet-btn.connected {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .wallet-address {
            font-size: 0.85em;
            color: #666;
            background: #f5f7fa;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .balance-display {
            font-size: 0.85em;
            color: #27ae60;
            background: #e8f8f5;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .ink-badge {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
            width: 100%;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 15px 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .game-section {
            display: none;
        }

        .game-section.active {
            display: block;
        }

        .start-screen {
            text-align: center;
            padding: 40px 0;
        }

        .wallet-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }

        .price-info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #0c5460;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .pets-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .pet-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
        }

        .pet-card:hover {
            transform: scale(1.05);
        }

        .pet-card.selected {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .nft-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f39c12;
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .pet-image {
            width: 200px;
            height: 200px;
            margin: 10px auto;
            border-radius: 10px;
            background: #2d1b4e;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .pet-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .pet-emoji {
            font-size: 5em;
        }

        .pet-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }

        .pet-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px 0;
        }

        .type-rock {
            background: #b8860b;
            color: white;
        }

        .type-paper {
            background: #4a90e2;
            color: white;
        }

        .type-scissors {
            background: #e74c3c;
            color: white;
        }

        .type-fire {
            background: #ff6b6b;
            color: white;
        }

        .type-water {
            background: #4ecdc4;
            color: white;
        }

        .type-grass {
            background: #95e1d3;
            color: white;
        }

        .pet-stats {
            margin-top: 15px;
            text-align: left;
        }

        .stat-bar {
            margin: 8px 0;
        }

        .stat-progress {
            background: #e0e0e0;
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .battle-arena {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
            margin: 30px 0;
        }

        .vs-text {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
        }

        .battle-result {
            text-align: center;
            padding: 30px;
            background: #f5f7fa;
            border-radius: 15px;
            margin: 20px 0;
        }

        .result-text {
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
        }

        .win {
            color: #27ae60;
        }

        .lose {
            color: #e74c3c;
        }

        .draw {
            color: #f39c12;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button-group {
            text-align: center;
            margin-top: 20px;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #2980b9;
            margin-bottom: 10px;
        }

        .network-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #27ae60;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .tx-hash {
            font-size: 0.8em;
            color: #3498db;
            word-break: break-all;
            margin-top: 10px;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <svg width="60" height="60" viewBox="0 0 200 200" style="filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#f472b6;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="100" cy="100" r="90" fill="none" stroke="url(#logoGradient)" stroke-width="8"/>
                    <circle cx="100" cy="100" r="75" fill="none" stroke="#2d1b4e" stroke-width="12"/>
                    <g transform="translate(60, 60)">
                        <rect x="10" y="30" width="10" height="10" fill="white"/>
                        <rect x="20" y="30" width="10" height="10" fill="white"/>
                        <rect x="30" y="30" width="10" height="10" fill="white"/>
                        <rect x="40" y="30" width="10" height="10" fill="white"/>
                        <rect x="50" y="30" width="10" height="10" fill="white"/>
                        <rect x="0" y="20" width="10" height="10" fill="white"/>
                        <rect x="10" y="20" width="10" height="10" fill="white"/>
                        <rect x="20" y="20" width="10" height="10" fill="white"/>
                        <rect x="10" y="10" width="10" height="10" fill="white"/>
                        <rect x="60" y="20" width="10" height="10" fill="white"/>
                        <rect x="70" y="10" width="10" height="10" fill="white"/>
                        <rect x="70" y="30" width="10" height="10" fill="white"/>
                        <rect x="20" y="40" width="10" height="10" fill="white"/>
                        <rect x="40" y="40" width="10" height="10" fill="white"/>
                    </g>
                </svg>
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    <h1 style="margin: 0; font-size: 1.8em; line-height: 1;">üéÆ AI Pet Battle Arena</h1>
                    <span class="ink-badge" style="width: fit-content;">‚õìÔ∏è Ink Blockchain</span>
                </div>
            </div>
            <div class="wallet-section">
                <button id="walletBtn" class="wallet-btn" onclick="toggleWallet()">
                    üîå Connect Wallet
                </button>
                <span id="walletAddress" class="wallet-address" style="display: none;"></span>
                <span id="balanceDisplay" class="balance-display" style="display: none;"></span>
            </div>
        </div>
        
        <p class="subtitle">Generate unique AI pets and battle! Each mint costs 0.01 ETH, replace for 0.001 ETH</p>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-label">Total Pet Types</div>
                <div class="stat-value">6</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Your Pets Minted</div>
                <div class="stat-value" id="userPetCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Battles Won</div>
                <div class="stat-value" id="battlesWon">0</div>
            </div>
        </div>

        <div id="startScreen" class="game-section active">
            <div class="start-screen">
                <div style="margin: 40px 0; text-align: center;">
                    <svg width="250" height="250" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 10px 30px rgba(102, 126, 234, 0.3));">
                        <defs>
                            <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#1e1b4b;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#4c1d95;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#ec4899;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f472b6;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="400" height="400" fill="url(#bgGradient)" rx="200"/>
                        <circle cx="200" cy="200" r="150" fill="none" stroke="url(#ringGradient)" stroke-width="16"/>
                        <circle cx="200" cy="200" r="125" fill="none" stroke="#2d1b4e" stroke-width="20"/>
                        <g transform="translate(100, 100)">
                            <rect x="20" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="40" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="60" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="80" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="100" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="120" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="0" y="40" width="20" height="20" fill="#ffffff"/>
                            <rect x="20" y="40" width="20" height="20" fill="#ffffff"/>
                            <rect x="40" y="40" width="20" height="20" fill="#ffffff"/>
                            <rect x="20" y="20" width="20" height="20" fill="#ffffff"/>
                            <rect x="40" y="20" width="20" height="20" fill="#ffffff"/>
                            <rect x="20" y="0" width="20" height="20" fill="#ffffff"/>
                            <rect x="40" y="0" width="20" height="20" fill="#ffffff"/>
                            <rect x="140" y="40" width="20" height="20" fill="#ffffff"/>
                            <rect x="160" y="20" width="20" height="20" fill="#ffffff"/>
                            <rect x="160" y="60" width="20" height="20" fill="#ffffff"/>
                            <rect x="180" y="10" width="20" height="20" fill="#ffffff"/>
                            <rect x="180" y="70" width="20" height="20" fill="#ffffff"/>
                            <rect x="40" y="80" width="20" height="20" fill="#ffffff"/>
                            <rect x="40" y="100" width="20" height="20" fill="#ffffff"/>
                            <rect x="80" y="80" width="20" height="20" fill="#ffffff"/>
                            <rect x="80" y="100" width="20" height="20" fill="#ffffff"/>
                        </g>
                    </svg>
                    <h2 style="margin-top: 20px; font-size: 2.2em; background: linear-gradient(135deg, #a78bfa 0%, #ec4899 50%, #f472b6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        AI Pet Battle Arena
                    </h2>
                </div>

                <div class="price-info">
                    <h3 style="text-align: center; margin-bottom: 15px;">üí∞ Pricing</h3>
                    <div class="price-item">
                        <span><strong>üé≤ Mint New Pet:</strong></span>
                        <span style="color: #27ae60; font-weight: bold;">0.000005 ETH ($0.01)</span>
                    </div>
                    <div class="price-item">
                        <span><strong>üîÑ Replace Pet:</strong></span>
                        <span style="color: #f39c12; font-weight: bold;">0.000005 ETH ($0.001)</span>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; text-align: center;">
                        Replacing costs 10% of minting price!
                    </p>
                </div>
                
                <div class="info-box">
                    <h3>üé® 6 Unique Pet Types</h3>
                    <p><strong>Rock üóø</strong> - Stone creatures, golems, earth elementals</p>
                    <p><strong>Paper üìÑ</strong> - Flying beasts, wind spirits, dragons</p>
                    <p><strong>Scissors ‚úÇÔ∏è</strong> - Sharp predators, blade warriors</p>
                    <p><strong>Fire üî•</strong> - Flame demons, phoenixes, lava monsters</p>
                    <p><strong>Water üíß</strong> - Sea creatures, ice beasts, aquatic dragons</p>
                    <p><strong>Grass üåø</strong> - Nature spirits, forest guardians, plant monsters</p>
                </div>

                <div class="info-box">
                    <h3>üåê About Ink Blockchain</h3>
                    <p>Ink is an Ethereum Layer 2 built for consumer crypto apps. Each pet is an NFT with AI-generated artwork!</p>
                    <div class="network-info">
                        <div class="status-dot"></div>
                        <span style="font-size: 0.9em; color: #666;">Connected to Ink Sepolia Testnet</span>
                    </div>
                </div>
                
                <button class="btn" onclick="generateMyPet()">üé≤ Mint Your First Pet (0.000005 ETH)</button>
            </div>
        </div>

        <div id="loadingScreen" class="game-section">
            <div class="loading">
                <div class="spinner"></div>
                <p id="loadingText">AI is creating your unique pet...</p>
            </div>
        </div>

        <div id="myPetScreen" class="game-section">
            <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">Your Pet</h2>
            <div id="myPetContainer" class="pets-container"></div>
            <div id="txInfo" class="tx-hash" style="display: none;"></div>
            <div class="button-group">
                <button class="btn" onclick="findOpponent()">‚öîÔ∏è Find Opponent</button>
                <button class="btn danger" onclick="replacePet()">üîÑ Replace Pet (0.0000005 ETH)</button>
            </div>
        </div>

        <div id="battleScreen" class="game-section">
            <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">Battle Arena</h2>
            <div class="battle-arena">
                <div id="battleMyPet"></div>
                <div class="vs-text">VS</div>
                <div id="battleOpponentPet"></div>
            </div>
            <div class="button-group">
                <button class="btn" onclick="startBattle()">‚ö° Battle!</button>
            </div>
        </div>

        <div id="resultScreen" class="game-section">
            <div class="battle-result">
                <div id="resultMessage"></div>
            </div>
            <div class="button-group">
                <button class="btn" onclick="playAgain()">üîÑ Play Again</button>
                <button class="btn danger" onclick="replacePet()">üé≤ Replace Pet (0.0000005 ETH)</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3modal/1.9.12/index.min.js"></script>
    <script>
        let myPet = null;
        let opponentPet = null;
        let walletConnected = false;
        let userAddress = null;
        let provider = null;
        let signer = null;
        let web3Modal = null;
        let userPetCount = 0;
        let battlesWon = 0;

        const MINT_PRICE = "0.000005"; // ETH
        const REPLACE_PRICE = "0.0000005"; // ETH (10% of mint)

        const petTypes = ['rock', 'paper', 'scissors', 'fire', 'water', 'grass'];
        
        const petTypeDescriptions = {
            rock: 'stone golem with massive boulder armor',
            paper: 'ethereal wind dragon with flowing paper wings',
            scissors: 'sharp-clawed assassin beast with blade limbs',
            fire: 'blazing phoenix demon wreathed in flames',
            water: 'crystalline ice serpent with flowing water',
            grass: 'ancient tree spirit covered in vines'
        };

        function initWeb3Modal() {
            const providerOptions = {
                walletconnect: {
                    package: window.WalletConnectProvider,
                    options: {
                        infuraId: "demo"
                    }
                }
            };

            web3Modal = new window.Web3Modal.default({
                cacheProvider: false,
                providerOptions,
                disableInjectedProvider: false,
            });
        }

        async function toggleWallet() {
            if (walletConnected) {
                disconnectWallet();
            } else {
                await connectWallet();
            }
        }

        async function connectWallet() {
            if (window.self !== window.top) {
                const useDemoMode = confirm(
                    '‚ö†Ô∏è Running in iframe (Claude artifacts)\n\n' +
                    'Wallet connections are limited in iframes.\n\n' +
                    'Options:\n' +
                    '‚úÖ Click OK for DEMO MODE\n' +
                    'üåê Or save locally and open in browser for real wallet'
                );
                
                if (useDemoMode) {
                    simulateDemoWallet();
                }
                return;
            }

            if (typeof window.ethereum !== 'undefined') {
                await connectMetaMask();
            } else if (web3Modal) {
                await connectWeb3Modal();
            } else {
                const useDemoMode = confirm(
                    '‚ö†Ô∏è No Web3 wallet detected!\n\n' +
                    'Please install MetaMask or use mobile wallet.\n\n' +
                    'Click OK to use DEMO MODE instead.'
                );
                
                if (useDemoMode) {
                    simulateDemoWallet();
                }
            }
        }

        async function connectMetaMask() {
            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                userAddress = accounts[0];

                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0xBAAC2' }],
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0xBAAC2',
                                    chainName: 'Ink Sepolia Testnet',
                                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                    rpcUrls: ['https://rpc-gel-sepolia.inkonchain.com'],
                                    blockExplorerUrls: ['https://explorer-sepolia.inkonchain.com']
                                }],
                            });
                        } catch (addError) {
                            console.error('Error adding Ink network:', addError);
                        }
                    }
                }

                signer = await provider.getSigner();
                walletConnected = true;
                await updateWalletUI();
            } catch (error) {
                console.error('Error connecting MetaMask:', error);
                alert('Failed to connect wallet.');
            }
        }

        async function connectWeb3Modal() {
            try {
                if (!web3Modal) initWeb3Modal();
                const instance = await web3Modal.connect();
                provider = new ethers.BrowserProvider(instance);
                const accounts = await provider.listAccounts();
                if (accounts.length > 0) {
                    userAddress = accounts[0].address;
                    signer = await provider.getSigner();
                    walletConnected = true;
                    await updateWalletUI();
                }
            } catch (error) {
                console.error('Error connecting via Web3Modal:', error);
            }
        }

        function simulateDemoWallet() {
            const demoAddress = '0x' + Array.from({length: 40}, () => 
                Math.floor(Math.random() * 16).toString(16)).join('');
            
            userAddress = demoAddress;
            walletConnected = true;
            updateWalletUI();
        }

        async function updateWalletUI() {
            document.getElementById('walletBtn').textContent = '‚úÖ Connected';
            document.getElementById('walletBtn').classList.add('connected');
            document.getElementById('walletAddress').textContent = 
                `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
            document.getElementById('walletAddress').style.display = 'inline-block';

            if (provider && !userAddress.startsWith('0x0')) {
                const balance = await provider.getBalance(userAddress);
                const ethBalance = ethers.formatEther(balance);
                document.getElementById('balanceDisplay').textContent = 
                    `üí∞ ${parseFloat(ethBalance).toFixed(4)} ETH`;
                document.getElementById('balanceDisplay').style.display = 'inline-block';
            } else {
                document.getElementById('balanceDisplay').textContent = 'üí∞ Demo Mode';
                document.getElementById('balanceDisplay').style.display = 'inline-block';
            }
        }

        function disconnectWallet() {
            walletConnected = false;
            userAddress = null;
            provider = null;
            signer = null;
            
            if (web3Modal) {
                web3Modal.clearCachedProvider();
            }

            document.getElementById('walletBtn').textContent = 'üîå Connect Wallet';
            document.getElementById('walletBtn').classList.remove('connected');
            document.getElementById('walletAddress').style.display = 'none';
            document.getElementById('balanceDisplay').style.display = 'none';
        }

        function showSection(sectionId) {
            document.querySelectorAll('.game-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        async function generateMyPet() {
            if (!walletConnected) {
                const connect = confirm('Connect wallet to mint NFT pet for 0.01 ETH?\n\nClick OK to connect, Cancel for demo mode.');
                if (connect) {
                    await connectWallet();
                    if (!walletConnected) return;
                }
            }

            if (walletConnected && signer) {
                const confirmed = confirm(
                    `Mint new pet NFT?\n\n` +
                    `Cost: ${MINT_PRICE} ETH\n` +
                    `This will be recorded on Ink blockchain.`
                );
                
                if (!confirmed) return;

                document.getElementById('loadingText').textContent = 'Processing payment...';
                showSection('loadingScreen');

                try {
                    const tx = await signer.sendTransaction({
                        to: '0x0000000000000000000000000000000000000001',
                        value: ethers.parseEther(MINT_PRICE)
                    });
                    
                    document.getElementById('loadingText').textContent = 'Transaction sent! Generating pet...';
                    await tx.wait();
                    
                    displayTxInfo(tx.hash, 'Minted');
                    userPetCount++;
                    document.getElementById('userPetCount').textContent = userPetCount;
                } catch (error) {
                    alert('Transaction failed: ' + error.message);
                    showSection('startScreen');
                    return;
                }
            }

            document.getElementById('loadingText').textContent = 'AI is creating your unique pet...';
            showSection('loadingScreen');
            myPet = await generatePetWithAI();
            displayMyPet();
            showSection('myPetScreen');
        }

        async function replacePet() {
            if (!walletConnected) {
                await connectWallet();
                if (!walletConnected) return;
            }

            if (walletConnected && signer) {
                const confirmed = confirm(
                    `Replace your current pet?\n\n` +
                    `Cost: ${REPLACE_PRICE} ETH (10% discount)\n` +
                    `Your current pet will be burned.`
                );
                
                if (!confirmed) return;

                showSection('loadingScreen');
                document.getElementById('loadingText').textContent = 'Processing replacement...';

                try {
                    const tx = await signer.sendTransaction({
                        to: '0x0000000000000000000000000000000000000001',
                        value: ethers.parseEther(REPLACE_PRICE)
                    });
                    
                    document.getElementById('loadingText').textContent = 'Burning old pet and generating new one...';
                    await tx.wait();
                    
                    displayTxInfo(tx.hash, 'Replaced');
                } catch (error) {
                    alert('Transaction failed: ' + error.message);
                    showSection('myPetScreen');
                    return;
                }
            }

            document.getElementById('loadingText').textContent = 'AI is creating your new pet...';
            myPet = await generatePetWithAI();
            displayMyPet();
            showSection('myPetScreen');
        }

        function displayTxInfo(hash, action) {
            const txInfo = document.getElementById('txInfo');
            txInfo.innerHTML = `
                ‚úÖ ${action} successfully!<br>
                TX: <a href="https://explorer-sepolia.inkonchain.com/tx/${hash}" target="_blank" style="color: #3498db;">${hash.substring(0, 10)}...${hash.substring(56)}</a>
            `;
            txInfo.style.display = 'block';
        }

        async function generatePetWithAI() {
            const type = petTypes[Math.floor(Math.random() * petTypes.length)];
            
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [{
                            role: "user",
                            content: `Generate a creative fantasy name for a ${type}-type battle pet. The pet is described as: "${petTypeDescriptions[type]}". Respond with ONLY the name, nothing else. Maximum 2 words.`
                        }]
                    })
                });

                const data = await response.json();
                const aiName = data.content[0].text.trim();

                const imageUrl = await generatePetImage(type, aiName);

                return {
                    name: aiName,
                    type: type,
                    imageUrl: imageUrl,
                    attack: Math.floor(Math.random() * 30) + 70,
                    defense: Math.floor(Math.random() * 30) + 70,
                    speed: Math.floor(Math.random() * 30) + 70,
                    isNFT: walletConnected
                };
            } catch (error) {
                console.error('AI generation failed:', error);
                return generateFallbackPet(type);
            }
        }

        async function generatePetImage(type, name) {
            const svgIcons = {
                rock: 'üóø',
                paper: 'üìÑ',
                scissors: '‚úÇÔ∏è',
                fire: 'üî•',
                water: 'üíß',
                grass: 'üåø'
            };
            
            return `data:image/svg+xml,${encodeURIComponent(`
                <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
                    <rect width="200" height="200" fill="#2d1b4e"/>
                    <text x="100" y="120" font-size="80" text-anchor="middle" fill="white">${svgIcons[type]}</text>
                    <text x="100" y="180" font-size="16" text-anchor="middle" fill="white" font-family="Arial">${name}</text>
                </svg>
            `)}`;
        }

        function generateFallbackPet(type) {
            const fallbackNames = {
                rock: ['Boulder Beast', 'Stone Guardian', 'Rocky Titan'],
                paper: ['Wind Dancer', 'Sky Phantom', 'Paper Dragon'],
                scissors: ['Blade Master', 'Sharp Claw', 'Steel Striker'],
                fire: ['Flame Lord', 'Inferno Beast', 'Phoenix King'],
                water: ['Tidal Wave', 'Frost Dragon', 'Ocean Spirit'],
                grass: ['Forest Guard', 'Nature\'s Wrath', 'Vine Titan']
            };
            
            const name = fallbackNames[type][Math.floor(Math.random() * fallbackNames[type].length)];
            
            return {
                name: name,
                type: type,
                imageUrl: generatePetImage(type, name),
                attack: Math.floor(Math.random() * 30) + 70,
                defense: Math.floor(Math.random() * 30) + 70,
                speed: Math.floor(Math.random() * 30) + 70,
                isNFT: false
            };
        }

        function createPetCard(pet, showStats = true) {
            return `
                <div class="pet-card">
                    ${pet.isNFT ? '<div class="nft-badge">NFT</div>' : ''}
                    <div class="pet-image">
                        <img src="${pet.imageUrl}" alt="${pet.name}">
                    </div>
                    <div class="pet-name">${pet.name}</div>
                    <div class="pet-type type-${pet.type}">${pet.type.toUpperCase()}</div>
                    ${showStats ? `
                    <div class="pet-stats">
                        <div class="stat-bar">
                            <div class="stat-label">Attack: ${pet.attack}</div>
                            <div class="stat-progress">
                                <div class="stat-fill" style="width: ${pet.attack}%"></div>
                            </div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-label">Defense: ${pet.defense}</div>
                            <div class="stat-progress">
                                <div class="stat-fill" style="width: ${pet.defense}%"></div>
                            </div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-label">Speed: ${pet.speed}</div>
                            <div class="stat-progress">
                                <div class="stat-fill" style="width: ${pet.speed}%"></div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function displayMyPet() {
            document.getElementById('myPetContainer').innerHTML = createPetCard(myPet);
        }

        async function findOpponent() {
            showSection('loadingScreen');
            document.getElementById('loadingText').textContent = 'Finding opponent...';
            opponentPet = await generatePetWithAI();
            document.getElementById('battleMyPet').innerHTML = createPetCard(myPet);
            document.getElementById('battleOpponentPet').innerHTML = createPetCard(opponentPet);
            showSection('battleScreen');
        }

        function startBattle() {
            const result = determineBattleResult(myPet.type, opponentPet.type);
            if (result === 'win') {
                battlesWon++;
                document.getElementById('battlesWon').textContent = battlesWon;
            }
            displayBattleResult(result);
            showSection('resultScreen');
        }

        function determineBattleResult(myType, opponentType) {
            if (myType === opponentType) return 'draw';
            
            const winConditions = {
                rock: ['scissors', 'fire'],
                paper: ['rock', 'water'],
                scissors: ['paper', 'grass'],
                fire: ['grass', 'scissors'],
                water: ['fire', 'rock'],
                grass: ['water', 'paper']
            };
            
            return winConditions[myType]?.includes(opponentType) ? 'win' : 'lose';
        }

        function displayBattleResult(result) {
            let message = '';
            
            if (result === 'win') {
                message = `<div class="result-text win">üéâ VICTORY! üéâ</div>
                          <p style="font-size: 1.2em;">Your ${myPet.name} defeated ${opponentPet.name}!</p>
                          <p style="margin-top: 20px; color: #666;">${myPet.type} beats ${opponentPet.type}</p>`;
            } else if (result === 'lose') {
                message = `<div class="result-text lose">üíî DEFEAT üíî</div>
                          <p style="font-size: 1.2em;">${opponentPet.name} defeated your ${myPet.name}!</p>
                          <p style="margin-top: 20px; color: #666;">${opponentPet.type} beats ${myPet.type}</p>`;
            } else {
                message = `<div class="result-text draw">ü§ù DRAW ü§ù</div>
                          <p style="font-size: 1.2em;">Both pets are equally matched!</p>
                          <p style="margin-top: 20px; color: #666;">Both used ${myPet.type}</p>`;
            }
            
            document.getElementById('resultMessage').innerHTML = message;
        }

        function playAgain() {
            findOpponent();
        }

        window.addEventListener('load', function() {
            initWeb3Modal();
        });

        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    disconnectWallet();
                } else {
                    userAddress = accounts[0];
                    updateWalletUI();
                }
            });

            window.ethereum.on('chainChanged', function () {
                window.location.reload();
            });
        }
    </script>
</body>
</html>
